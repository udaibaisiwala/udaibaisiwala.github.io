# Glooko API in YAML for Swagger usage
---
swagger: '2.0'

################################################################################
#                              API Information                                 #
################################################################################
info:
  version: "1.0"
  title: Glooko API Specification
  description: | 
    Glooko provides API services that support data integration with 3rd party partners. Data integration is a core element in how Glooko adds value to 3rd party partners and allows our partners to: 
    
    - Receive data from Glooko.
    - Interact with Glooko data in their own applications, products, and services.
    
    This document is meant to provide a high-level description of our architecture, as well as share examples of how our APIs can be leveraged by patients and 3rd party partners in three main integration schemes:
    
    - Securely getting patient’s dashboard page.
    - Securely getting patient’s shared report.
    - Securely getting patient’s glucose data.
    
    These examples are meant to provide a sample of the different workflows, and are not comprehensive. For our strategic partners, Glooko will engage in other integration schemes that more closely match the architecture of our partners.The Glooko API currently provides different workflows of interaction between Glooko and a 3rd party app. These workflows include the use of Glooko’s ProConnect feature, which enables users (e.g. patients, members, research participants, etc.) to authorize the connection of their protected health information in Glooko to that of the 3rd party app.The Glooko API also supports two models of data exchange: 
    
    - Publish/Subscribe
    - Push/Pull
    
    Publish/Subscribe is an asynchronous communication method by which a 3rd party app can subscribe to events pertaining to their ProConnected userS. 
    Push/Pull is a synchronous communication method by which a 3rd party app can read, update, or create data on behalf of their ProConnected users.
    
    ## Terminology

    ### Authentication: 
    Glooko uses OAuth2 to validate client applications. The 3rd party app will only have access to patient data where the patient is setup with Glooko and has agreed to share their data with the 3rd party in question. This access is granted under what Glooko calls “ProConnect”.
    
    ### Communications: 
    
    HTTPS is utilized for communication security. Glooko does not send any data over non-secure channels. Glooko is a HIPAA Business Associate and is compliant with all privacy and security requirements.
    
    glooko_code: An identifier generated by Glooko that relates to a specific individual user (e.g. patient, member, research participant, etc.) in the Glooko database.
    
    JSON/BSON Payload: Glooko’s current API is used by iOS and Android clients, as well as by the Glooko browser-based UI.
    
    - Most data is serialized into JSON. However, in the case of binary data, we use BSON.
    - For example, BSON is used to provide a multi-page PDF patient-specific summary report that has graphs, charts and other data. Acquiring this PDF report is one of the first integrations we recommend for our 3rd party partners. An example of the first page of this report is available in the Appendix (Fig. 1). 
    
    ProConnect: Enables users (e.g. patients, members, research participants, etc.) to authorize the connection of their protected health information in Glooko to that of a 3rd party app.
    
    REST: Glooko leverages a Representational State Transfer (REST) architecture.
    
    user_id: An identifier used by 3rd party partners that relates to a specific user from their database.
    
    ## Login as Institution
    
    Currently, Glooko supports institution login through provisioned secret key and generated token, or through standardized OAuth2.
    
    Once the institution is setup in the Glooko system, there are options for institutions to use the Glooko API:
    
    - They are provided with the secret key, which is used to sign messages sent to the Glooko API.
    - A secret key is issued on demand, by using a standard institution login, and then new calls are signed with the secret key.
    - The institution is registered as an OAuth2 application in the Glooko API and is provided with an application ID and secret, which is used for the OAuth2 connection only. 
    
    ### Signing the API Calls
    Each request needs to have a GlookoAuthToken field, with the value calculated as MD5 hash of all parameters plus the secret key appended to it: `token= MD5(data + key)`.
    
    For Example -
    
    GET data:
    ```
    patient={glooko-code}&token={calculated-token}  
    ```
    
    Secret Key:
    ```
    1234      
    ```
    
    MD5 hash is calculated from:
    ```
    patient={glooko-code}1234  
    ```
    
    Calculated token is:
    ```
    2564a816b6d01904afb47b279af711a1 
    ```
    
    Parameter order and capitalization are not fixed - anything is OK, but the token must be generated using exactly the same data that was sent to the server. 
    
    Token must be sent as a lowercase string - token 2564a816b6d01904afb47b279af711a1 will work, but 2564A816B6D01904AFB47B279AF711A1 will not.


################################################################################
#                  Host, Base Path, Schemes and Content Types                  #
################################################################################
host: api.glooko.com
schemes:
  - https
basePath: /api/v1
produces:
  - application/json


################################################################################
#                                   Tags                                       #
################################################################################

#need to do this part


################################################################################
#                                  Security                                    #
################################################################################

#should populate this


################################################################################
#                                   Parameters                                 #
################################################################################

#I don't think this is relevant to us


################################################################################
#                                 Definitions                                  #
################################################################################

#Should prob use this in order to clean up paths definitions


################################################################################
#                                           Paths                              #
################################################################################
paths:

#can't figure out post requests...what is the url, etc
  
  /report:
    get:
      description: |
        Gets a PDF of the patient share report. 
      parameters:
        - name: patient
          in: query
          description: patient unique identifier
          type: string
          required: true
        - name: token
          in: query
          description: token is calculated using the methods described at the top
          type: string
          required: true
        - name: start_date
          in: query
          type: string
          description: start date for the report as yyyy-MM-dd
          required: true
        - name: end_date
          in: query
          type: string
          description: end date for the report as yyyy-MM-dd
          required: true
      responses:
        200:
          description: Successful response
          schema:
            title: pdfPatientDetails
            type: string
            description: "Binary representation of a PDF of patient's share report"
                
  /:
    get:
      description: |
        Gets an HTML form of the web dashboard
      parameters:
        - name: patient
          in: query
          description: patient unique identifier
          type: string
          required: true
        - name: token
          in: query
          description: token is calculated using the methods described at the top
          type: string
          required: true
      responses:
        200:
          description: Successful response
          schema:
            title: htmlWebDashboard
            type: string
            description: "HTML-formatted page that represents the patient's web dashboard"
            
  /readings/user_readings:
    get:
      description: |
        Gets an array of all the user readings
      parameters:
        - name: patient
          in: query
          description: patient unique idenitifier
          type: string
          required: true
        - name: token
          in: query
          description: calculated as described at top
          type: string
          required: true
        - name: start_date
          in: query
          description: start date as yyyy-MM-ddThh:mm:ssZ, default is 1/1/1970
          type: string
          required: false
        - name: end_date
          in: query
          description: end date as yyyy-MM-ddThh:mm:ssZ, default is current date
          type: string
          required: false
      responses:
        200:
          description: Successful response
          schema:
            title: User readings list
            type: array
            items:
              title: user reading
              type: object
              properties: 
                timestamp:
                  type: string
                  format: date-time
                  description: time of this reading
                value:
                  type: integer
                  description: value of the reading
                units:
                  type: string
                  description: units for this reading
                meter_name: 
                  type: string
                  description: name of this meter
                meter_serial:
                  type: string
                  description: serial number for this meter
              